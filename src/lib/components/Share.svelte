<script>
  import { slide } from "svelte/transition";

  export let shareData;

  let useFallbackShare = false;
  let copiedToClipboard = false;

  const socialUrls = [
    {
      name: "Twitter",
      href:
        "https://twitter.com/intent/tweet?" +
        new URLSearchParams({ text: shareData.text, url: shareData.url }),
    },
    {
      name: "LinkedIn",
      href:
        "https://www.linkedin.com/shareArticle?mini=true&url=" + shareData.url,
    },
    {
      name: "Facebook",
      href: "https://www.facebook.com/sharer/sharer.php?u=" + shareData.url,
    },
    {
      name: "Reddit",
      href:
        "https://reddit.com/submit?selftext=true&" +
        new URLSearchParams({ title: shareData.text, url: shareData.url }),
    },
  ];
</script>

<div>
  <div class="wrapper">
    <button on:click|preventDefault={() => history.back()}>&larr; Back</button>

    <button
      aria-label="Share"
      on:click={async () => {
        try {
          await navigator.share(shareData);
        } catch {
          return (useFallbackShare = !useFallbackShare);
        }
      }}
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        ><path
          fill="currentColor"
          fill-rule="evenodd"
          d="M10.752 1.994a.75.75 0 0 1-.744.756c-1.71.014-2.97.07-3.945.261c-.955.187-1.583.494-2.068.979c-.57.57-.897 1.34-1.069 2.62c-.174 1.3-.176 3.009-.176 5.387c0 2.38.002 4.088.176 5.388c.172 1.279.5 2.05 1.07 2.62c.569.57 1.34.897 2.619 1.069c1.3.174 3.009.176 5.388.176c2.378 0 4.087-.002 5.387-.176c1.28-.172 2.05-.5 2.62-1.07c.485-.484.792-1.112.979-2.067c.19-.976.246-2.236.261-3.945a.75.75 0 0 1 1.5.012c-.015 1.705-.068 3.093-.29 4.222c-.224 1.15-.633 2.083-1.39 2.84c-.894.895-2.035 1.3-3.48 1.494c-1.412.19-3.221.19-5.53.19h-.115c-2.309 0-4.118 0-5.53-.19c-1.445-.194-2.585-.6-3.48-1.494c-.895-.895-1.3-2.036-1.495-3.48c-.19-1.413-.19-3.222-.19-5.531v-.115c0-2.309 0-4.118.19-5.53c.194-1.445.6-2.586 1.495-3.48c.756-.757 1.69-1.166 2.84-1.39c1.128-.222 2.516-.276 4.22-.29a.75.75 0 0 1 .757.744Zm5.718-.524a.75.75 0 0 1 1.06 0l5 5a.75.75 0 0 1 0 1.06l-5 5a.75.75 0 1 1-1.06-1.06l3.72-3.72H14c-1.552 0-2.467.757-2.788 1.08l-.192.192l-.19.19c-.323.32-1.08 1.236-1.08 2.788v3a.75.75 0 0 1-1.5 0v-3c0-2.084 1.027-3.36 1.521-3.851l.19-.19l.188-.188C10.64 7.277 11.916 6.25 14 6.25h6.19l-3.72-3.72a.75.75 0 0 1 0-1.06Z"
          clip-rule="evenodd"
        /></svg
      >
    </button>
  </div>

  {#if useFallbackShare === true}
    <article transition:slide>
      <hgroup>
        <p>Share this blog</p>
        <small>{shareData.text}</small>
        <!-- <p>
          {shareData.url.replace(
            process.env.NODE_ENV === "production" ? "https://" : "http://",
            ""
          )}
        </p> -->
      </hgroup>

      <button
        class="clipboard"
        on:click|preventDefault={async function () {
          try {
            await navigator.clipboard.writeText(shareData.url);
            copiedToClipboard = true;
            setTimeout(() => (copiedToClipboard = false), 4000);
          } catch (e) {
            throw new Error(e);
          }
        }}
      >
        {#if copiedToClipboard}
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            style="color: var(--secondary);"
            ><path
              fill="currentColor"
              fill-rule="evenodd"
              d="M7.263 3.259A2.25 2.25 0 0 1 9.5 1.25h5a2.25 2.25 0 0 1 2.237 2.009c.763.015 1.423.055 1.987.158c.758.14 1.403.405 1.928.93c.602.602.86 1.36.982 2.26c.116.866.116 1.969.116 3.336v6.11c0 1.368 0 2.47-.116 3.337c-.122.9-.38 1.658-.982 2.26c-.602.602-1.36.86-2.26.982c-.867.116-1.97.116-3.337.116h-6.11c-1.367 0-2.47 0-3.337-.116c-.9-.121-1.658-.38-2.26-.982c-.602-.602-.86-1.36-.981-2.26c-.117-.867-.117-1.97-.117-3.337v-6.11c0-1.367 0-2.47.117-3.336c.12-.9.38-1.658.981-2.26c.525-.525 1.17-.79 1.928-.93c.564-.103 1.224-.143 1.987-.158Zm.002 1.5c-.718.015-1.272.052-1.718.134c-.566.104-.895.27-1.138.514c-.277.277-.457.666-.556 1.4c-.101.755-.103 1.756-.103 3.191v6c0 1.436.002 2.437.103 3.192c.099.734.28 1.122.556 1.4c.277.276.665.457 1.4.555c.754.102 1.756.103 3.191.103h6c1.435 0 2.436-.001 3.192-.103c.734-.098 1.122-.279 1.399-.556c.277-.276.457-.665.556-1.399c.101-.755.103-1.756.103-3.192v-6c0-1.435-.002-2.436-.103-3.192c-.099-.733-.28-1.122-.556-1.399c-.244-.243-.572-.41-1.138-.514c-.446-.082-1-.119-1.718-.134A2.25 2.25 0 0 1 14.5 6.75h-5a2.25 2.25 0 0 1-2.235-1.99ZM9.5 2.75a.75.75 0 0 0-.75.75v1c0 .414.336.75.75.75h5a.75.75 0 0 0 .75-.75v-1a.75.75 0 0 0-.75-.75h-5Zm6.048 7.738a.75.75 0 0 1-.036 1.06l-4.286 4a.75.75 0 0 1-1.024 0l-1.714-1.6a.75.75 0 1 1 1.024-1.096l1.202 1.122l3.774-3.522a.75.75 0 0 1 1.06.036Z"
              clip-rule="evenodd"
            /></svg
          >
        {:else}
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            style="color: var(--secondary);"
            ><path
              fill="currentColor"
              fill-rule="evenodd"
              d="M7.263 3.259A2.25 2.25 0 0 1 9.5 1.25h5a2.25 2.25 0 0 1 2.237 2.009c.763.015 1.423.055 1.987.158c.758.14 1.403.405 1.928.93c.602.602.86 1.36.982 2.26c.116.866.116 1.969.116 3.336v6.11c0 1.368 0 2.47-.116 3.337c-.122.9-.38 1.658-.982 2.26c-.602.602-1.36.86-2.26.982c-.867.116-1.97.116-3.337.116h-6.11c-1.367 0-2.47 0-3.337-.116c-.9-.121-1.658-.38-2.26-.982c-.602-.602-.86-1.36-.981-2.26c-.117-.867-.117-1.97-.117-3.337v-6.11c0-1.367 0-2.47.117-3.336c.12-.9.38-1.658.981-2.26c.525-.525 1.17-.79 1.928-.93c.564-.103 1.224-.143 1.987-.158Zm.002 1.5c-.718.015-1.272.052-1.718.134c-.566.104-.895.27-1.138.514c-.277.277-.457.666-.556 1.4c-.101.755-.103 1.756-.103 3.191v6c0 1.436.002 2.437.103 3.192c.099.734.28 1.122.556 1.4c.277.276.665.457 1.4.555c.754.102 1.756.103 3.191.103h6c1.435 0 2.436-.001 3.192-.103c.734-.098 1.122-.279 1.399-.556c.277-.276.457-.665.556-1.399c.101-.755.103-1.756.103-3.192v-6c0-1.435-.002-2.436-.103-3.192c-.099-.733-.28-1.122-.556-1.399c-.244-.243-.572-.41-1.138-.514c-.446-.082-1-.119-1.718-.134A2.25 2.25 0 0 1 14.5 6.75h-5a2.25 2.25 0 0 1-2.235-1.99ZM9.5 2.75a.75.75 0 0 0-.75.75v1c0 .414.336.75.75.75h5a.75.75 0 0 0 .75-.75v-1a.75.75 0 0 0-.75-.75h-5Zm2.5 6.5a.75.75 0 0 1 .75.75v2.25H15a.75.75 0 0 1 0 1.5h-2.25V16a.75.75 0 0 1-1.5 0v-2.25H9a.75.75 0 0 1 0-1.5h2.25V10a.75.75 0 0 1 .75-.75Z"
              clip-rule="evenodd"
            /></svg
          >
        {/if}

        <span
          >{#if copiedToClipboard}Copied to clipboard{:else}Copy link to
            clipboard{/if}</span
        >
      </button>

      <p class="banner">Social media</p>
      <div class="links">
        {#each socialUrls as { name, href }}
          <a {href} aria-label="Share to {name}" class="social-share-link">
            {#if name === "Twitter"}
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="19.6"
                viewBox="0 0 256 209"
                ><path
                  fill="#55acee"
                  d="M256 25.45a105.04 105.04 0 0 1-30.166 8.27c10.845-6.5 19.172-16.793 23.093-29.057a105.183 105.183 0 0 1-33.351 12.745C205.995 7.201 192.346.822 177.239.822c-29.006 0-52.523 23.516-52.523 52.52c0 4.117.465 8.125 1.36 11.97c-43.65-2.191-82.35-23.1-108.255-54.876c-4.52 7.757-7.11 16.78-7.11 26.404c0 18.222 9.273 34.297 23.365 43.716a52.312 52.312 0 0 1-23.79-6.57c-.003.22-.003.44-.003.661c0 25.447 18.104 46.675 42.13 51.5a52.592 52.592 0 0 1-23.718.9c6.683 20.866 26.08 36.05 49.062 36.475c-17.975 14.086-40.622 22.483-65.228 22.483c-4.24 0-8.42-.249-12.529-.734c23.243 14.902 50.85 23.597 80.51 23.597c96.607 0 149.434-80.031 149.434-149.435c0-2.278-.05-4.543-.152-6.795A106.748 106.748 0 0 0 256 25.45"
                /></svg
              >
            {/if}
            {#if name === "LinkedIn"}
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 256 256"
                ><path
                  fill="#0A66C2"
                  d="M218.123 218.127h-37.931v-59.403c0-14.165-.253-32.4-19.728-32.4c-19.756 0-22.779 15.434-22.779 31.369v60.43h-37.93V95.967h36.413v16.694h.51a39.907 39.907 0 0 1 35.928-19.733c38.445 0 45.533 25.288 45.533 58.186l-.016 67.013ZM56.955 79.27c-12.157.002-22.014-9.852-22.016-22.009c-.002-12.157 9.851-22.014 22.008-22.016c12.157-.003 22.014 9.851 22.016 22.008A22.013 22.013 0 0 1 56.955 79.27m18.966 138.858H37.95V95.967h37.97v122.16ZM237.033.018H18.89C8.58-.098.125 8.161-.001 18.471v219.053c.122 10.315 8.576 18.582 18.89 18.474h218.144c10.336.128 18.823-8.139 18.966-18.474V18.454c-.147-10.33-8.635-18.588-18.966-18.453"
                /></svg
              >
            {/if}
            {#if name === "Facebook"}
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 256 256"
                ><path
                  fill="#1877F2"
                  d="M256 128C256 57.308 198.692 0 128 0C57.308 0 0 57.307 0 128c0 63.888 46.808 116.843 108 126.445V165H75.5v-37H108V99.8c0-32.08 19.11-49.8 48.347-49.8C170.352 50 185 52.5 185 52.5V84h-16.14C152.958 84 148 93.867 148 103.99V128h35.5l-5.675 37H148v89.445c61.192-9.602 108-62.556 108-126.445"
                /><path
                  fill="#FFF"
                  d="m177.825 165l5.675-37H148v-24.01C148 93.866 152.959 84 168.86 84H185V52.5S170.352 50 156.347 50C127.11 50 108 67.72 108 99.8V128H75.5v37H108v89.445A128.959 128.959 0 0 0 128 256a128.9 128.9 0 0 0 20-1.555V165h29.825"
                /></svg
              >
            {/if}
            {#if name === "Reddit"}
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 256 256"
                ><circle cx="128" cy="128" r="128" fill="#FF4500" /><path
                  fill="#FFF"
                  d="M213.15 129.22c0-10.376-8.391-18.617-18.617-18.617a18.74 18.74 0 0 0-12.97 5.189c-12.818-9.157-30.368-15.107-49.9-15.87l8.544-39.981l27.773 5.95c.307 7.02 6.104 12.667 13.278 12.667c7.324 0 13.275-5.95 13.275-13.278c0-7.324-5.95-13.275-13.275-13.275c-5.188 0-9.768 3.052-11.904 7.478l-30.976-6.562c-.916-.154-1.832 0-2.443.458c-.763.458-1.22 1.22-1.371 2.136l-9.464 44.558c-19.837.612-37.692 6.562-50.662 15.872a18.74 18.74 0 0 0-12.971-5.188c-10.377 0-18.617 8.391-18.617 18.617c0 7.629 4.577 14.037 10.988 16.939a33.598 33.598 0 0 0-.458 5.646c0 28.686 33.42 52.036 74.621 52.036c41.202 0 74.622-23.196 74.622-52.036a35.29 35.29 0 0 0-.458-5.646c6.408-2.902 10.985-9.464 10.985-17.093ZM85.272 142.495c0-7.324 5.95-13.275 13.278-13.275c7.324 0 13.275 5.95 13.275 13.275s-5.95 13.278-13.275 13.278c-7.327.15-13.278-5.953-13.278-13.278Zm74.317 35.251c-9.156 9.157-26.553 9.768-31.588 9.768c-5.188 0-22.584-.765-31.59-9.768c-1.371-1.373-1.371-3.51 0-4.883c1.374-1.371 3.51-1.371 4.884 0c5.8 5.8 18.008 7.782 26.706 7.782c8.699 0 21.058-1.983 26.704-7.782c1.374-1.371 3.51-1.371 4.884 0c1.22 1.373 1.22 3.51 0 4.883Zm-2.443-21.822c-7.325 0-13.275-5.95-13.275-13.275s5.95-13.275 13.275-13.275c7.327 0 13.277 5.95 13.277 13.275c0 7.17-5.95 13.275-13.277 13.275Z"
                /></svg
              >
            {/if}
          </a>
        {/each}
      </div>
    </article>
  {/if}
</div>

<style>
  .wrapper {
    display: flex;
    justify-content: space-between;
  }

  article {
    margin-left: auto;
    margin-top: 0;
    width: fit-content;
    background-color: var(--footer-color);
  }

  article hgroup > :first-child {
    margin-bottom: 0;
    font-weight: 700;
  }

  article hgroup > :last-child {
    font-size: small;
  }

  .social-share-link {
    padding-inline: 1rem;
    text-decoration: none;
  }

  button {
    padding: 0.25rem;
  }

  .banner {
    font-size: small;
    color: var(--secondary);
    margin-bottom: var(--spacing);
    display: flex;
    gap: 0.25rem;
  }

  .banner::before,
  .banner::after {
    content: "";
    flex: 1 1;
    border-bottom: 1px solid var(--secondary);
    margin: auto;
  }

  .clipboard {
    display: flex;
    gap: 8px;
  }

  .clipboard > :last-child {
    margin-top: 2px;
  }

  .links {
    display: flex;
    justify-content: center;
  }
</style>
